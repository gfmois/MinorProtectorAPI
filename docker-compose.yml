version: '3.2'
services:
  age_classificator:
    image: python:3.13.0b1-alpine
    container_name: age_classificator
    restart: always
    volumes:
      - ./backend/age_classificator:/app
    command: > 
      /bin/sh -c "apk update && apk add build-base && apk add --no-cache make && 
      pip install -r /app/requirements.txt && 
      cd /app && make"
    networks:
      - backend-network

  face_detector:
    image: python:3.13.0b1-alpine
    container_name: face_detector
    restart: always
    volumes:
      - ./backend/face_detector:/app
    command: >
      /bin/sh -c "apk update && apk add build-base && apk add --no-cache build-base libffi-dev openblas-dev gfortran py3-pip &&
      pip install --no-cache-dir numpy &&
      pip install --no-cache-dir opencv-python-headless &&
      cd /app && make"
    networks:
      - backend-network

  gateway:
    image: python:3.13.0b1-alpine
    container_name: gateway
    depends_on:
      - face_detector
      - age_classificator
    restart: always
    volumes:
      - ./backend/gateway:/app
    ports:
      - 80:5001
    command: >
      /bin/sh -c "apk update && apk add build-base && apk add --no-cache make && pip install -r /app/requirements.txt && cd /app && make"
    networks:
      - backend-network

  # frontend:
  #   build:
  #     context: ./frontend
  #     dockerfile: Dockerfile
  #   ports:
  #     - "8080:80"

networks:
  backend-network: